commonfields:
  id: PowerShell Remoting
  version: -1
name: PowerShell Remoting
display: PowerShell Remoting
category: Utilities
description: |-
  Use this integration in order to remote into another machine (windows/linux) using SSH, requires PowerShell core on both ends.
  Installation steps needed on target machine can be found in Microsoft's official documentation:
  https://docs.microsoft.com/en-us/powershell/scripting/learn/remoting/ssh-remoting-in-powershell-core?view=powershell-6
configuration:
- display: Domain
  name: domain
  type: 0
  required: false
  additionalinfo: Fully Qualafied Domain Name suffix to be added to the Hostname.
- display: DNS
  name: dns
  type: 0
  required: false
- display: Username
  name: credentials
  type: 9
  required: true
  additionalinfo: User name in target machine
- display: Test Hostname
  name: hostname
  type: 0
  required: false
  additionalinfo: Hostname to provide a test for the integration connectivity.
script:
  script: ''
  type: powershell
  commands:
  - name: ps-remote-query
    arguments:
    - name: host
      required: true
      description: The hostname or IP address on which to create the ETL file. For
        example myhost or 10.0.0.1. The user can provide a comma delimited list of
        values.
      isArray: true
    - name: command
      required: true
      description: PowerShell command (can be single or multiple in order of execution)
        to run on the target machine
    outputs:
    - contextPath: PsRemote.Query
      description: Object that contains data about the response of a command run in
        target machine
      type: unknown
    - contextPath: PsRemote.Query.Result
      description: The result of the command run from target machine
      type: string
    - contextPath: PsRemote.Query.Command
      description: The command sent to target machine, used as ID of that query
      type: string
    description: Remote to target machine which has powershell core installed on it
      and is set up for remoting
    execution: true
  - name: ps-remote-download-file
    arguments:
    - name: host
      required: true
      description: The hostname or IP address on which to create the ETL file. For
        example myhost or 10.0.0.1. The user can provide a comma delimited list of
        values.
    - name: path
      required: true
      description: The expected path of the file to download.
    - name: zip_file
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: This argument specifies whether to compress the file. Values can
        be true or false.
      defaultValue: "false"
    - name: check_hash
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: Compare the values of the original file and downloaded file, and
        returns an error if any differences are found.
      defaultValue: "false"
    outputs:
    - contextPath: PsRemote.FileName
      description: File name.
      type: String
    - contextPath: PsRemote.FileSize
      description: File size.
      type: Number
    - contextPath: PsRemote.FileMD5
      description: The MD5 hash of the file.
      type: String
    - contextPath: PsRemote.FileSHA1
      description: The SHA1 hash of the file.
      type: String
    - contextPath: PsRemote.FileSHA256
      description: The SHA256 hash of the file.
      type: String
    - contextPath: PsRemote.FileExtension
      description: The extension of the file.
      type: String
    - contextPath: File.Size
      description: The size of the file in bytes.
      type: Number
    - contextPath: File.SHA1
      description: The SHA1 hash of the file.
      type: String
    - contextPath: File.SHA256
      description: The SHA256 hash of the file.
      type: String
    - contextPath: File.SHA512
      description: The SHA512 hash of the file.
      type: String
    - contextPath: File.Name
      description: The full file name.
      type: String
    - contextPath: File.SSDeep
      description: The ssdeep hash of the file.
      type: String
    - contextPath: File.EntryID
      description: The ID for locating the file in the War Room.
      type: String
    - contextPath: File.Info
      description: The file information.
      type: String
    - contextPath: File.Type
      description: The file type.
      type: String
    - contextPath: File.MD5
      description: The MD5 hash of the file.
      type: String
    - contextPath: File.Extension
      description: 'The file extension, for example: ''txt''.'
      type: String
    description: Download a file from the remote endpoint.
  - name: ps-remote-etl-create-start
    arguments:
    - name: host
      required: true
      description: The hostname or IP address on which to create the ETL file. For
        example myhost or 10.0.0.1. The user can provide a comma delimited list of
        values.
      isArray: true
    - name: etl_path
      required: true
      description: The path on the hostname on which to create the ETL file. For example
        c:\temp\myhost.etl. The default value will be C:\Users\<usename>\AppData\Local\Temp\NetTraces\NetTrace.etl
    - name: etl_filter
      description: The filter to apply when creating the ETL file. For example IPv4.Address=1.1.1.1
        to capture traffic just from the 1.1.1.1 IP address. If no filter is specified
        all traffic will be recorded. More example can be found here, https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-r2-and-2012/jj129382(v=ws.11)#using-filters-to-limit-etl-trace-file-details
    - name: etl_time_limit
      description: This argument sets after how long the etl will stop capturing.
        If no value is specified the capture will continue until the ps-remote-etl-create-stop
        command has been executed for the same host or the user configured the etl_max_size
        setting. Possible values can be 5 minutes, 1 day etc.
    - name: etl_max_size
      description: The maximum file size for the ETL. Once the file has reached this
        size the capute will stop. For example 10MB. The default size is 10MB.
      defaultValue: "10"
    - name: overwrite
      auto: PREDEFINED
      predefined:
      - "yes"
      - "no"
      description: Overwrite the file in path.
      defaultValue: "no"
    outputs:
    - contextPath: PsRemote.EtlFileName
      description: The file name for the ETL
      type: string
    - contextPath: PsRemote.EtlFilePath
      description: The file path and name for the ETL
    description: This command starts the recording of an ETL file on a windows endpoint.
      ETL is just like a PCAP file which is created by the Windows Netsh command.
  - name: ps-remote-etl-create-stop
    arguments:
    - name: host
      required: true
      description: The hostname or IP address on which to create the ETL file. For
        example myhost or 10.0.0.1. The user can provide a comma delimited list of
        values.
      isArray: true
    description: This command ends the recording of an ETL file on a windows endpoint.
  - name: ps-remote-export-registry
    arguments:
    - name: host
      required: true
      description: The hostname or IP address on which to create the ETL file. For
        example myhost or 10.0.0.1. The user can provide a comma delimited list of
        values.
      isArray: true
    - name: reg_key_hive
      description: The registry key or hive to export. For example reg_key_hive=`HKEY_LOCAL_MACHINE`.
        If the user specifies all as the value. The entire registry will be exported.
        Default value is all.
      defaultValue: all
    - name: file_path
      required: true
      description: The path and name on the windows host where the registry file will
        be created. For example, file_path=c:\hklm.reg.
    outputs:
    - contextPath: PsRemote.RegFileSha256
      description: The SHA256 for the registry file.
      type: string
    - contextPath: PsRemote.RegFileSize
      description: The file size for the registry file.
      type: string
    - contextPath: PsRemote.RegFilePath
      description: The file path and name for the registry file.
      type: string
    - contextPath: PsRemote.RegFileName
      description: The file name for the registry file.
      type: string
    description: This command exports the specified Registry of hive to a file.
  - name: ps-remote-upload-file
    arguments:
    - name: entry_id
      required: true
      description: File entry ID as appears in XSOAR.
    - name: host
      required: true
      description: The hostname or IP address on which to upload the file. For example
        myhost or 10.0.0.1.
    - name: path
      required: true
      description: The target path of the file to upload.
    - name: zip_file
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: This argument specifies whether to compress the file. Values can
        be true or false.
      defaultValue: "false"
    - name: check_hash
      auto: PREDEFINED
      predefined:
      - "true"
      - "false"
      description: Compare the values of the original file and downloaded file, and
        returns an error if any differences are found.
      defaultValue: "false"
    description: Uploads a file from XSOAR to the remote endpoint.
  dockerimage: mcr.microsoft.com/powershell:centos-7
  runonce: false
